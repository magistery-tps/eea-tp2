---
title: "Enfoque Estadistico del Aprendizaje - Trabajo Final - Regresion Bayesiana"
fig_width: 3 
fig_height: 3 
output:
  html_document:
    highlight: pygments
    theme: sandstone
    toc: yes
    df_print: paged
    includes:
      before_body: ./header.html
  html_notebook: 
    toc: yes
    toc_float: yes
    df_print: paged
---

### Adrian Marino

### Claudio Collado


## 0. Librerias

A continuación se realiza la llamada de las librerías a ser utilizadas a lo largo del Trabajo Practico:

```{r message=FALSE, warning=FALSE}
# install.packages(pacman)
library(pacman)
p_load(tidyverse, tidymodels, rsample, ggplot2, GGally, caret, arm)
p_load_gh('adrianmarino/commons')
import('../src/dataset.R')
import('../src/plot.R')
import('../src/model.R')
```

## 1. Dataset y Analisis Exploratorio

### 1.1 Lectura del dataset

```{r message=FALSE, warning=FALSE}
# Lectura
dataset <- read.csv("../datasets/properati_preprocesado_.csv")

# Resumen
dataset %>% glimpse()
```


```{r}
show_values(dataset %>% dplyr::select(l3, rooms, bathrooms, property_type))
```


### 1.2 Variables

Se enumeran y describen breve-mente cada variable que forma parte del dataset seleccionado para el Trabajo Practico:

- l3
- rooms
- bathrooms
- surface_total
- surface_covered
- price
- property_type
- precio_en_miles

### 1.3 Factorizacion y renombrado de variables

Debido al tipo de dato y largo de los strings de algunas variables se procede a factorizar y renombrar variables para simplificar la manipulación y trabajo posterior:

```{r message=FALSE,warning=FALSE}
dataset <- dataset %>% 
  dplyr::select(-id) %>%
  rename(neighborhood = l3) %>% 
  mutate_if(is.character, as.factor)
```


### 1.4 Conteo de NA

```{r message=FALSE,warning=FALSE}
missings_summary(dataset)
```

### 1.5 Correlaciones

```{r}
corr_plot(dataset)
```

```{r}
segmented_pairs_plot(dataset, segment_column='property_type')
```



## 2. Split train - test


```{r message=FALSE, warning=FALSE}
train_test <- train_test_split(dataset, train_size = 0.7, shuffle = TRUE)
train_set <- train_test[[1]]
test_set  <- train_test[[2]]
```

## 3. Modelo lineal

## 4. Modelo bayesiano

```{r}
beyesian_model <- bayesglm(
  price ~ neighborhood + rooms + bathrooms + surface_total + surface_covered + property_type, 
  family      = gaussian(link=identity), 
  data        = train_set,
  prior.df    = Inf,
  prior.mean  = 0,
  prior.scale = NULL,
  maxit       = 10000
)
summary(beyesian_model)
```

## 5. Modelo bayesiano robusto
